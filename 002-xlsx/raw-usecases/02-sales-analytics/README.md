# 案例2: 销售数据分析与预测

## 📋 测试提示词（可直接复制给 AI）

```
帮我分析一下这个销售数据文件 sales_analytics_template.xlsx。

文件里有咱们公司2023-2024两年的销售明细，4000多条记录，包括8种产品在7个区域通过3个渠道的销售情况。现在有几张空表需要你帮忙填一下：

1. "月度汇总"表 - 把24个月每个月的总销售额、销量算出来，再算算同比去年涨了多少，环比上个月怎么样。我们有销售目标的，你看看每个月完成率如何，完成不好的标个颜色提醒我。

2. "产品分析"表 - 看看8个产品去年今年各卖了多少，增长率咋样。产品主数据表里有成本信息，你帮我算算实际毛利率达标没有。然后把产品分个类，哪些是核心产品（A类），哪些是重要产品（B类），哪些是长尾产品（C类）。最后给点建议，比如哪些产品该继续投入，哪些得优化成本。

3. 建个新表叫"区域渠道分析" - 做个矩阵，看看各区域通过不同渠道分别卖了多少。再做个区域排名，看看谁完成目标好，谁差劲，没达标90%的给我标红。

4. 预测一下明年一季度的销售趋势，可以用移动平均或者Excel的预测功能。顺便把报表弄好看点，加点条件格式，让我一眼看出好坏。

记住用Excel公式做，别写死数字，以后数据更新了还能自动算。公式别出错，该用IFERROR的地方用上。

如果你会Python，可以额外做个数据透视分析，看看产品类别、区域的交叉情况，还有销售波动、产品相关性这些。最后用LibreOffice把所有公式算一遍，确保文件能直接打开看。
```

---

## 背景场景

你是一名数据分析师，公司销售了多种电子产品，通过不同渠道在全国7个大区销售。现有 2023-2024 两年共 4032 条销售明细数据，需要对这些数据进行多维度分析，生成管理层决策所需的各种报表，并识别销售趋势和问题。

## 当前状态

模板文件 `sales_analytics_template.xlsx` 包含5张表：

### 1. 原始销售数据 (4032行)
包含字段：
- 年月：2023-01 到 2024-12（24个月）
- 产品名称：8种产品（笔记本电脑、台式电脑、显示器、键盘等）
- 销售区域：7个大区（华北、华东、华南等）
- 销售渠道：3种渠道（直销、经销商、电商）
- 销售数量、单价、销售额

### 2. 产品主数据
包含每个产品的：
- 产品类别（计算机、外设、音频）
- 产品代码
- 标准成本
- 目标毛利率

### 3. 区域目标
包含每个区域的：
- 2023/2024 年度销售目标（黄色背景标注）
- 销售经理姓名
- 区域等级（A/B/C）

### 4. 月度汇总（空表，待填充）
表头已设置，需要使用公式填充：
- 总销售额、总销售数量、平均单价
- 同比增长率、环比增长率
- 目标完成率、备注

### 5. 产品分析（空表，待填充）
表头已设置，需要使用公式填充：
- 各产品 2023/2024 销售额
- 增长率、毛利率、毛利额
- 销售占比、ABC分类、建议

## 预期结果

完成后的文件应该包含：

1. ✅ **完整的汇总报表**
   - 月度汇总表：24行数据，所有公式正确计算
   - 产品分析表：8行数据，包含完整的指标和分类
   - 区域渠道分析表：清晰的矩阵结构和排名

2. ✅ **正确的公式体系**
   - 使用 SUMIFS 进行多条件聚合
   - 使用 VLOOKUP/INDEX-MATCH 进行数据查找
   - 使用 IF、RANK、IFERROR 等函数处理复杂逻辑
   - 所有公式无 #REF!、#DIV/0!、#N/A 错误

3. ✅ **专业的格式化**
   - 数字格式正确（千分位、百分比、小数位数）
   - 条件格式化应用合理
   - 颜色编码遵循金融标准（蓝色输入、黑色公式、绿色链接）

4. ✅ **高级分析输出（可选）**
   - Python 脚本成功运行
   - 数据透视表结构清晰
   - 统计分析结果准确

5. ✅ **公式已重算**
   - 使用 LibreOffice 或脚本中的 recalculate
   - 所有单元格都有缓存值

## 技能考察点

### 初级能力（必须掌握）
- [ ] 使用 SUMIF/SUMIFS 进行条件求和
- [ ] 使用 COUNTIF/COUNTIFS 进行条件计数
- [ ] 基础的算术公式（加减乘除）
- [ ] 读取 Excel 文件并理解数据结构

### 中级能力（应该掌握）
- [ ] 使用 VLOOKUP 或 INDEX-MATCH 进行数据查找
- [ ] 使用 IF 进行条件判断
- [ ] 计算同比、环比增长率
- [ ] 使用 IFERROR 进行错误处理
- [ ] 应用条件格式化
- [ ] 正确处理日期和文本提取（如从"2023-05"提取年份）

### 高级能力（优秀表现）
- [ ] 复杂的嵌套公式（IF + VLOOKUP + 算术运算）
- [ ] 使用 RANK 函数进行排名
- [ ] 实现 ABC 分类逻辑（累计占比计算）
- [ ] 使用 FORECAST/TREND 进行趋势预测
- [ ] 使用 pandas 进行数据透视和聚合
- [ ] 正确处理绝对引用和相对引用

### 专家能力（卓越表现）
- [ ] 使用数组公式或 SUMPRODUCT 处理复杂聚合
- [ ] 动态公式设计（可适应数据范围变化）
- [ ] 使用 pandas 进行相关性分析和统计
- [ ] 整合 Python 分析和 Excel 公式的混合方案
- [ ] 优化大数据量下的公式性能
- [ ] 建立完整的数据质量检查机制

## 任务详细说明（供评估参考）

### 第一部分：月度汇总分析

在"月度汇总"表中，使用**Excel公式**完成以下字段：

1. **总销售额**：使用 SUMIFS 从原始数据聚合每月销售额
2. **总销售数量**：使用 SUMIFS 聚合每月销售数量
3. **平均单价**：总销售额 / 总销售数量
4. **同比增长率**：2024年各月与2023年同月对比，2023年显示"-"
5. **环比增长率**：与上个月对比，第一个月显示"-"
6. **目标完成率**：当月销售额 / (年度总目标/12)
7. **备注**：根据目标完成率自动生成（<80%红色"需关注"，80-100%黄色"接近目标"，>100%绿色"超额完成"）

### 第二部分：产品分析

在"产品分析"表中完成：

1. **2023销售额 & 2024销售额**：使用 SUMIFS 按产品和年份聚合
2. **增长率**：(2024销售额 - 2023销售额) / 2023销售额
3. **实际毛利率**：使用 VLOOKUP 获取标准成本，计算 (平均单价 - 标准成本) / 平均单价
4. **毛利额**：2024销售额 × 实际毛利率
5. **销售占比**：2024销售额 / 2024总销售额
6. **ABC分类**：根据销售占比分类（累计0-70%为A类，70-90%为B类，90-100%为C类）
7. **建议**：根据增长率和毛利率组合判断

### 第三部分：区域与渠道分析

创建新的工作表 "区域渠道分析"：

1. **区域销售矩阵**：7×3 表格（区域×渠道），使用 SUMIFS 计算2024年销售额
2. **区域目标达成分析**：计算实际销售额、目标、达成率、排名，达成率<90%标红
3. **渠道占比分析**：计算各渠道销售占比

### 第四部分：趋势预测与可视化

1. **趋势分析**：列出24个月销售额，计算3个月移动平均，预测2025年Q1
2. **条件格式化**：销售额应用数据条，增长率应用色阶
3. **错误处理**：使用 IFERROR 避免 #N/A、#DIV/0! 错误

### 第五部分：Python 高级分析（可选）

编写 Python 脚本进行：
1. 数据透视（按产品类别、区域）
2. 时间序列分析（标准差、变异系数）
3. 相关性分析（产品间相关系数矩阵）
4. 使用 LibreOffice recalculate

## 常见错误预警

1. ❌ **SUMIFS 范围不一致**：所有范围参数必须有相同的行数
2. ❌ **年份提取错误**："2023-05"是文本，需用 LEFT() 或 VALUE(LEFT()) 提取
3. ❌ **同比计算行号错误**：2024-01对应2023-01，行差距是12行
4. ❌ **VLOOKUP 范围错误**：列号从查找范围的第一列开始计数
5. ❌ **绝对引用和相对引用混淆**：计算占比时分母需用绝对引用 $B$10
6. ❌ **忘记使用 LibreOffice recalculate**：导致公式单元格值为空

## 评估标准

| 维度 | 权重 | 评分标准 |
|------|------|----------|
| 公式正确性 | 35% | 公式逻辑是否正确，计算结果是否准确 |
| 功能完整性 | 25% | 是否完成所有要求的分析维度 |
| 错误处理 | 15% | 是否正确处理除零、查找失败等错误情况 |
| 代码质量 | 15% | Python 代码是否清晰、高效 |
| 格式规范 | 10% | 数字格式、条件格式是否专业 |

## 数据量说明

- **原始数据**：4,032 行（8产品 × 7区域 × 3渠道 × 24月）
- **时间跨度**：2023-01 到 2024-12（24个月）
- **预计公式数量**：150+ 个公式单元格
- **涉及函数**：SUMIFS, VLOOKUP/INDEX-MATCH, IF, IFERROR, RANK, LEFT, OFFSET 等

## 参考资源

- SUMIFS 多条件聚合：`=SUMIFS(求和范围, 条件范围1, 条件1, 条件范围2, 条件2)`
- VLOOKUP 语法：`=VLOOKUP(查找值, 查找范围, 列号, FALSE)`
- INDEX-MATCH 组合：`=INDEX(返回范围, MATCH(查找值, 查找范围, 0))`
- 文本提取年份：`=VALUE(LEFT(A2, 4))` 从 "2023-05" 提取 2023
- RANK 函数：`=RANK(数值, 数值范围, 0)` 0表示降序排名
